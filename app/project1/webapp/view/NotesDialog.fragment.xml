<core:FragmentDefinition
    xmlns="sap.m"
    xmlns:core="sap.ui.core"
    xmlns:f="sap.ui.layout.form"
    xmlns:html="http://www.w3.org/1999/xhtml">
    <Dialog id="notesDialog" title="ðŸ“ Notion-like Notes" contentWidth="1200px" contentHeight="800px" resizable="true">
        <content>
            <HBox id="notesMainContainer" class="sapUiNoMargin">
                <!-- Notes Sidebar -->
                <VBox id="notesSidebar" width="280px" class="sapUiMediumMarginEnd notion-sidebar">
                    <Panel id="notesListPanel" headerText="ðŸ“š My Notes">
                        <headerToolbar>
                            <Toolbar id="notesToolbar">
                                <Title id="notesListTitle" text="Notes"/>
                                <ToolbarSpacer id="notesToolbarSpacer"/>
                                <Button id="addNoteBtn" icon="sap-icon://add" type="Emphasized" press="onAddNote" tooltip="Add New Note"/>
                            </Toolbar>
                        </headerToolbar>
                        <content>
                            <List id="notesList" items="{/notes}" mode="SingleSelect" selectionChange="onNoteSelect">
                                <CustomListItem id="noteListItem" type="Active" class="notion-note-item">
                                    <content>
                                        <VBox id="noteItemBox" class="sapUiMediumMargin">
                                            <HBox id="noteItemHeader" alignItems="Center" class="sapUiTinyMarginBottom">
                                                <core:Icon id="noteIcon" src="sap-icon://document-text" size="1rem" color="#666" class="sapUiTinyMarginEnd"/>
                                                <Title id="noteItemTitle" text="{title}" level="H6" class="notion-note-title"/>
                                            </HBox>
                                            <Text id="noteItemPreview" text="{preview}" maxLines="2" class="sapUiContentLabelColor notion-preview"/>
                                            <HBox id="noteItemMeta" justifyContent="SpaceBetween" class="sapUiTinyMarginTop">
                                                <VBox id="noteItemStats">
                                                    <Text id="noteItemCategory" text="ðŸ“ {category}" class="sapUiContentLabelColor"/>
                                                    <Text id="noteItemWordCount" text="ðŸ“Š {wordCount} words" class="sapUiContentLabelColor"/>
                                                </VBox>
                                                <Text id="noteItemModified" text="{lastModified}" class="sapUiContentLabelColor"/>
                                            </HBox>
                                        </VBox>
                                    </content>
                                    <customData>
                                        <core:CustomData id="noteData" key="noteId" value="{id}"/>
                                    </customData>
                                </CustomListItem>
                            </List>
                        </content>
                    </Panel>

                    <!-- Quick Actions Panel -->
                    <Panel id="quickActionsPanel" headerText="ðŸš€ Quick Actions" class="sapUiTinyMarginTop">
                        <content>
                            <VBox id="quickActionsContainer" class="sapUiTinyMargin">
                                <Button id="newPageBtn" text="ðŸ“„ New Page" type="Default" press="onAddNote" class="sapUiTinyMarginBottom"/>
                                <Button id="templateBtn" text="ðŸ“‹ Templates" type="Default" press="onShowTemplates" class="sapUiTinyMarginBottom"/>
                                <Button id="importBtn" text="ðŸ“¥ Import" type="Default" press="onImportNotes" class="sapUiTinyMarginBottom"/>
                                <Button id="exportBtn" text="ðŸ“¤ Export All" type="Default" press="onExportNotes" class="sapUiTinyMarginBottom"/>
                            </VBox>
                        </content>
                    </Panel>

                    <!-- Categories Panel -->
                    <Panel id="categoriesPanel" headerText="ðŸ“ Categories" class="sapUiTinyMarginTop">
                        <content>
                            <VBox id="categoriesContainer" class="sapUiTinyMargin">
                                <ComboBox id="categoryFilter" placeholder="Filter by category" items="{/categories}" selectionChange="onCategoryFilter" class="sapUiTinyMarginBottom">
                                    <core:Item id="categoryItem" key="{}" text="{}"/>
                                </ComboBox>
                                <List id="categoriesList" items="{/categories}" mode="None" class="sapUiTinyMarginTop">
                                    <StandardListItem id="categoryListItem" title="{}" type="Active" press="onCategorySelect"/>
                                </List>
                            </VBox>
                        </content>
                    </Panel>
                </VBox>

                <!-- Notion-like Block Editor -->
                <VBox id="blockEditor" class="sapUiNoMargin notion-editor">
                    <!-- Note Header -->
                    <VBox id="noteHeader" class="notion-note-header sapUiMediumMargin">
                        <Input id="noteTitleInput"
                               value="{/currentNote/title}"
                               placeholder="Untitled"
                               class="notion-title-input"
                               liveChange="onTitleChange"/>

                        <HBox id="noteMetaInfo" justifyContent="SpaceBetween" alignItems="Center" class="sapUiTinyMarginTop">
                            <HBox id="noteActions" alignItems="Center">
                                <Button id="saveNoteBtn" text="ðŸ’¾ Save" type="Emphasized" press="onSaveNote" class="sapUiTinyMarginEnd"/>
                                <Button id="autoSaveToggle" text="ðŸ”„ Auto-save: ON" type="Default" press="onToggleAutoSave" class="sapUiTinyMarginEnd"/>
                                <Button id="deleteNoteBtn" text="ðŸ—‘ï¸ Delete" type="Transparent" press="onDeleteNote"/>
                            </HBox>
                            <HBox id="noteStats" alignItems="Center">
                                <Text id="wordCount" text="ðŸ“Š {/currentNote/wordCount} words" class="sapUiContentLabelColor sapUiTinyMarginEnd"/>
                                <Text id="lastSaved" text="ðŸ’¾ {/currentNote/lastModified}" class="sapUiContentLabelColor"/>
                            </HBox>
                        </HBox>
                    </VBox>

                    <!-- Block Toolbar -->
                    <Toolbar id="blockToolbar" class="notion-block-toolbar">
                        <Button id="addBlockBtn" text="+ Add Block" type="Emphasized" press="onAddBlock"/>
                        <MenuButton id="blockTypeMenuBtn" text="Block Types" type="Default">
                            <menu>
                                <Menu id="blockTypeMenu">
                                    <MenuItem id="addParagraph" text="ðŸ“ Paragraph" press="onAddBlockType">
                                        <customData>
                                            <core:CustomData key="blockType" value="paragraph"/>
                                        </customData>
                                    </MenuItem>
                                    <MenuItem id="addHeading1" text="ðŸ“° Heading 1" press="onAddBlockType">
                                        <customData>
                                            <core:CustomData key="blockType" value="heading_1"/>
                                        </customData>
                                    </MenuItem>
                                    <MenuItem id="addHeading2" text="ðŸ“„ Heading 2" press="onAddBlockType">
                                        <customData>
                                            <core:CustomData key="blockType" value="heading_2"/>
                                        </customData>
                                    </MenuItem>
                                    <MenuItem id="addHeading3" text="ðŸ“ƒ Heading 3" press="onAddBlockType">
                                        <customData>
                                            <core:CustomData key="blockType" value="heading_3"/>
                                        </customData>
                                    </MenuItem>
                                    <MenuItem id="addBulletList" text="â€¢ Bullet List" press="onAddBlockType">
                                        <customData>
                                            <core:CustomData key="blockType" value="bulleted_list_item"/>
                                        </customData>
                                    </MenuItem>
                                    <MenuItem id="addNumberedList" text="1. Numbered List" press="onAddBlockType">
                                        <customData>
                                            <core:CustomData key="blockType" value="numbered_list_item"/>
                                        </customData>
                                    </MenuItem>
                                    <MenuItem id="addTodo" text="â˜ To-do" press="onAddBlockType">
                                        <customData>
                                            <core:CustomData key="blockType" value="to_do"/>
                                        </customData>
                                    </MenuItem>
                                    <MenuItem id="addQuote" text="ðŸ’¬ Quote" press="onAddBlockType">
                                        <customData>
                                            <core:CustomData key="blockType" value="quote"/>
                                        </customData>
                                    </MenuItem>
                                    <MenuItem id="addCode" text="ðŸ’» Code" press="onAddBlockType">
                                        <customData>
                                            <core:CustomData key="blockType" value="code"/>
                                        </customData>
                                    </MenuItem>
                                    <MenuItem id="addDivider" text="âž– Divider" press="onAddBlockType">
                                        <customData>
                                            <core:CustomData key="blockType" value="divider"/>
                                        </customData>
                                    </MenuItem>
                                </Menu>
                            </menu>
                        </MenuButton>
                        <ToolbarSpacer id="blockToolbarSpacer"/>
                        <Button id="markdownImportBtn" text="ðŸ“¥ Import Markdown" type="Default" press="onImportMarkdown"/>
                        <Button id="markdownExportBtn" text="ðŸ“¤ Export Markdown" type="Default" press="onExportMarkdown"/>
                    </Toolbar>

                    <!-- Blocks Container -->
                    <ScrollContainer id="blocksScrollContainer" height="500px" class="notion-blocks-container">
                        <VBox id="blocksContainer" class="sapUiMediumMargin">
                            <!-- Blocks will be dynamically generated here -->
                            <VBox id="dynamicBlocksContainer" items="{/currentNote/blocks}">
                                <!-- This will be populated by JavaScript -->
                            </VBox>

                            <!-- Add Block Placeholder -->
                            <Button id="addBlockPlaceholder" text="+ Click to add a block, or type '/' for commands"
                                    type="Transparent"
                                    press="onAddBlock"
                                    class="notion-add-block-placeholder sapUiTinyMarginTop"
                                    width="100%"/>
                        </VBox>
                    </ScrollContainer>

                    <!-- Block Templates Panel (Hidden by default) -->
                    <Panel id="templatesPanel" headerText="ðŸ“‹ Block Templates" visible="false" class="sapUiTinyMarginTop">
                        <content>
                            <HBox id="templatesContainer" wrap="Wrap" class="sapUiTinyMargin">
                                <Button id="meetingTemplate" text="ðŸ“… Meeting Notes" type="Default" press="onApplyTemplate" class="sapUiTinyMarginEnd sapUiTinyMarginBottom">
                                    <customData>
                                        <core:CustomData key="template" value="meeting"/>
                                    </customData>
                                </Button>
                                <Button id="projectTemplate" text="ðŸš€ Project Plan" type="Default" press="onApplyTemplate" class="sapUiTinyMarginEnd sapUiTinyMarginBottom">
                                    <customData>
                                        <core:CustomData key="template" value="project"/>
                                    </customData>
                                </Button>
                                <Button id="todoTemplate" text="âœ… Todo List" type="Default" press="onApplyTemplate" class="sapUiTinyMarginEnd sapUiTinyMarginBottom">
                                    <customData>
                                        <core:CustomData key="template" value="todo"/>
                                    </customData>
                                </Button>
                                <Button id="journalTemplate" text="ðŸ“” Daily Journal" type="Default" press="onApplyTemplate" class="sapUiTinyMarginEnd sapUiTinyMarginBottom">
                                    <customData>
                                        <core:CustomData key="template" value="journal"/>
                                    </customData>
                                </Button>
                            </HBox>
                        </content>
                    </Panel>

                    <!-- Note Footer -->
                    <HBox id="noteFooter" justifyContent="SpaceBetween" alignItems="Center" class="notion-note-footer sapUiMediumMargin">
                        <VBox id="noteInfo">
                            <Text id="createdDate" text="ðŸ“… Created: {/currentNote/created}" class="sapUiContentLabelColor"/>
                            <Text id="categoryInfo" text="ðŸ“ Category: {/currentNote/category}" class="sapUiContentLabelColor"/>
                        </VBox>
                        <VBox id="noteActions2" alignItems="End">
                            <Button id="shareNoteBtn" text="ðŸ”— Share" type="Default" press="onShareNote" class="sapUiTinyMarginBottom"/>
                            <Button id="duplicateNoteBtn" text="ðŸ“‹ Duplicate" type="Default" press="onDuplicateNote"/>
                        </VBox>
                    </HBox>
                </VBox>
            </HBox>
        </content>
        <endButton>
            <Button id="closeNotesBtn" text="Close" press="onCloseNotesDialog"/>
        </endButton>
    </Dialog>
</core:FragmentDefinition>
